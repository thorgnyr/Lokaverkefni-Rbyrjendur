---
title: "Lokaverkefni í R fyrir byrjendur"
author: "Þórgnýr Thoroddsen"
date: "19 September 2016"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
Sys.setlocale("LC_ALL", "is_IS.UTF-8")
library(knitr)
```

###Verkefni 1: Tilgreinið fjölda eigna í Vestmannaeyjum í gagnasafninu.
1. Við skulum byrja á að hlaða gagnasafninu í hlut sem við köllum *fasteignir*. Það gerum við með *read.table()* skipuninni. Því næstu einföldum við gagnaskránna með því að draga út þá dálka sem við munum nota í verkefninu.

```{r}
fasteignir <- read.table("gagnasafn_endurmat2017_iso.csv", header = T, sep = ",", na.strings = "(null)", fileEncoding = "latin1")
einfaldad <- fasteignir[,c(4,8,9,27,28,31,48,49,51)]
```

[Á þessarri vefsíðu](http://www.skra.is/library/Samnyttar-skrar-/Fasteignamat-2017/2016_LANDSBYGGD_IBU_v2.pdf) má sjá kort með yfirliti yfir matssvæði eigna. Þar sjáum við að eignir í Vestmannaeyjum eru skráðar með kóðanum 8200. Með því móti getum við fundið út fjölda eignanna á einfaldan hátt.

```{r}
sum(einfaldad$matssvaedi == 8200)
```

###Verkefni 2: Fjarlægið eignir sem eru ekki skilgreindar sem Einbýlishús, Íbúðareign, Parhús eða Raðhús. Notið einungis þessar gerðir eigna það sem eftir er verkefnisins.

Það gerum við á eftirfarandi hátt.

```{r}
einfaldad <- einfaldad[einfaldad$teg_eign == "Einbýlishús" | einfaldad$teg_eign == "Íbúðareign" | einfaldad$teg_eign == "Parhús" | einfaldad$teg_eign == "Raðhús", ]
```

###Verkefni 3: Tilgreinið hversu margar eignir af hverri gerð eru á Seltjarnarnesi, Garðabæ og í Mosfellsbæ (einbýlishús, íbúðareign, parhús, raðhús).
 
Hér gerum við nýjan gagnaramma sem inniheldur bara upplýsingar um tegund eignar og auðkenni sveitarfélags. Við gerum *svfn* breytuna að *factor* og breytum gildunum í nafnið á umræddum sveitarfélögum. Þar sem gildin raðast eftir stærðarröð þá nægir fyrir mig að skrifa nöfnin í þeirri röð sem stærðirnar segja til um. Því næst keyri ég *droplevels*, en sú skipun tekur út ónotuð *levels* (sem þó sjást ekki í gagnarammanum). Síðast set ég síðan gögnin í töflu.
```{r}
sp3_dataframe <- einfaldad[c(einfaldad$svfn == 1100 | einfaldad$svfn == 1300 | einfaldad$svfn == 1604),]
sp3_dataframe$svfn <- as.factor(sp3_dataframe$svfn)
levels(sp3_dataframe$svfn) <- c("Seltjarnarnes", "Garðabær", "Mosfellsbær")
sp3_dataframe$teg_eign <- droplevels(sp3_dataframe$teg_eign)
table(sp3_dataframe$teg_eign, sp3_dataframe$svfn)
```

###Verkefni 4: Teiknið mynd sem er lýsandi fyrir fjölda eigna af hverri gerð í sveitafélögunum þremur hér að ofan.

Hér búum við til stöplarit sem að lýsir fjölda og samsetningu eigna í sveitarfélögunum. Við byrjum á því að hlaða inn *ggplot2* skipanasafninu. Stöplaritið er skilgreint með *geom_bar()* og með *scale_fill_discrete()* skipunin er síðan notuð til að gera tegundastafla í stöplunum.

```{r}
library(ggplot2)
sp3_dataframe <- sp3_dataframe[2:3]
g <- ggplot(sp3_dataframe, aes(x=svfn, fill = teg_eign)) + geom_bar() + xlab("") + ylab("Fjöldi") + scale_fill_discrete(name = "Tegund eignar", labels = c("Einbýlishús", "Íbúðareign", "Parhús", "Raðhús"))
g
```

###Verkefni 5: Búið til nýtt gagnasafn sem inniheldur aðeins eignir í Reykjavík.

Þetta gerum við einfaldlega með því að skrifa í snatri 

```{r} 
reykjavik <- einfaldad[einfaldad$svfn == 0, ]
```

###Verkefni 6: Tilgreinið meðalverð einbýlishúsa, íbúða, parhúsa og raðhúsa í Reykjavík. Er meðaltal góður mælikvarði á miðju í þessum tilfellum?

Við notum *mean()* skipunina á núvirðisdálk reykjavíkurgagnasettsins og sjáum að meðaltalið er `r mean(reykjavik$nuvirdi)` og miðgildið er `r median(reykjavik$nuvirdi)`.

###Verkefni 7: Tilgreinið meðalstærð og miðgildi stærðar einbýlishúsa, íbúða, parhúsa og raðhúsa í Reykjavík.

**Einbýlishús**
```{r}
mean(reykjavik$ibm2[reykjavik$teg_eign == "Einbýlishús"])
median(reykjavik$ibm2[reykjavik$teg_eign == "Einbýlishús"])
```

**Íbúðir**
```{r}
mean(reykjavik$ibm2[reykjavik$teg_eign == "Íbúðareign"])
median(reykjavik$ibm2[reykjavik$teg_eign == "Íbúðareign"])
```

**Parhús**
```{r}
mean(reykjavik$ibm2[reykjavik$teg_eign == "Parhús"])
median(reykjavik$ibm2[reykjavik$teg_eign == "Parhús"])
```

**Raðhús**
```{r}
mean(reykjavik$ibm2[reykjavik$teg_eign == "Raðhús"])
median(reykjavik$ibm2[reykjavik$teg_eign == "Raðhús"])
```

#Verkefni 8: Teiknið mynd sem sýnir mun á verði eigna eftir gerð í Reykjavík (einbýlishús, íbúðareign, parhús, raðhús).

g2 <- ggplot(reykjavik, aes(x=teg_eign, y=nuvirdi, colour = "#3366FF", alpha = 0.1)) + geom_jitter(alpha = 0.05, colour = "black") + geom_boxplot(outlier.size = 0.1) + xlab("") + ylab("Verð í þúsundum") + theme(legend.position = "none")
g2





#9----
g3 <- ggplot(reykjavik, aes(x=ibm2, y=nuvirdi)) + geom_point(size = 0.1)
g3







#10----
random <- set.seed(250382)
n <- dim(reykjavik)[1]
x500 <- sample(n, 500)
r500 <- reykjavik[reykjavik$matssvaedi == 100 | reykjavik$matssvaedi == 130 | reykjavik$matssvaedi == 150,]
r500$matssvaedi <- cut(r500$matssvaedi, c(0, 100, 130, 150))
levels(r500$matssvaedi) <- c("Laugarneshverfi og Vogar", "Grafarvogur: Rimar, Engi, Víkur, Borgir", "Seljahverfi")

#11----
r500$staerdarflokkur <- cut(r500$ibm2, c(0, 60, 90.1, max(r500$ibm2, na.rm = TRUE)), right=F)
levels(r500$staerdarflokkur) <- c("Lítil Eign","Meðalstór Eign", "Stór Eign")






#12----
prop.table(table(r500$matssvaedi, r500$staerdarflokkur), margin = 1)








#13----
medalbkar <- r500[r500$staerdarflokkur == "Meðalstór Eign",]
t.test(medalbkar[medalbkar$fjbkar > 0,] ~ medalbkar[medalbkar$fjbkar == 0,])

medalbkar <- r500[r500$staerdarflokkur == "Meðalstór Eign", ]
medalbkar$fjbkar[medalbkar$fjbkar >0] <- "1"
medalbkar <- medalbkar[-1125,]
table(medalbkar$fjbkar)
t.test(medalbkar$nuvirdi~medalbkar$fjbkar)
Munurinn er ekki marktækur.

#14----
fit.aov<-aov(nuvirdi ~ matssvaedi, data=medalbkar)
TukeyHSD(fit.aov)

Ekki marktækur munur á Seljahverfi og Grafarvogi, en marktækur þar sem borið er saman við Voga. Athugum meðaltölin:

Lau-Vog
mean(medalbkar$nuvirdi[medalbkar$matssvaedi == "Laugarneshverfi og Vogar"])
mean(medalbkar$nuvirdi[medalbkar$matssvaedi == "Grafarvogur: Rimar, Engi, Víkur, Borgir"])
mean(medalbkar$nuvirdi[medalbkar$matssvaedi == "Seljahverfi"])

Meðaltölin eru vissulega áberandi hærri á milli Laugarness/Voga við hin tvö svæðin, en þau sín á milli.

#15----
fyrirmodel <- r500[r500$matssvaedi =="Laugarneshverfi og Vogar",]
model <- lm(nuvirdi ~ ibm2, data = fyrirmodel)
summary(model)
plot(model)
